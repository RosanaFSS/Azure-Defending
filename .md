<p align="center">April 15, 2025<br>
Hey there, fellow lifelong learner! IÂ´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and Iâ€™m genuinely excited to join you on this adventure.<br>
ItÂ´s part of my $$\textcolor{#FF69B4}{\textbf{344}}$$-day-streak in  <a href="https://tryhackme.com">TryHackMe</a>.<br><br>
<img width="300px" src="" alt="Your Image Badge"><br>
<img width="200px" src="https://github.com/user-attachments/assets/a831d20b-7256-48cf-8fe9-ad7c930d41e3"></p>
<h1 align="center"> $$\textcolor{#3bd62d}{\textnormal{KQL (Kusto): Introduction}}$$</h1>
<p align="center"><em>Microsoft Sentinel challenge for SOC analysts: incident investigation & threat hunting.</em>.<br>
It is classified as an easy walkthrough.<br>
You can join it for ðŸ†“ using your own virtual machine with openVPN or TryHackMeÂ´s AttackBox if you are subscribed.<br>
Can be accessed clicking  <a href="https://tryhackme.com/room/justlookingn">here</a>.</p>

<p align="center"> <img width="900px" src=""> </p>

<br>
<br>

<h2>Task 1 . Introduction</h2>


<h3>Prerequisites</h3>
<p>- Having completed the Microsoft Sentinel module.</p>



<br>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>

<br>

> 1.1. <em>I have successfully started the challenge lab and logged in to the Azure portal.</em><br><a id='1.1'></a>
>> <strong><code>No answer needed</code></strong><br>
<p></p>

<br>

![image](https://github.com/user-attachments/assets/ab57d530-ffd1-4926-b7b6-8b77d782d042)

<br>




![image](https://github.com/user-attachments/assets/7623bba0-f9a1-4508-aa4a-b8c23575185c)

<br>
<br>

<h2>Task 2 . Logs Ready, Steady, Go!</h2>

<br>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

<br>

> 2.1. <em>What's the row count for SigninLogs_CL table?</em><br><a id='2.1'></a>
>> <strong><code>___</code></strong><br>
<p></p>

<br>

![image](https://github.com/user-attachments/assets/8ee66ccc-ea65-493b-88dd-205702a20bc9)

<br>

![image](https://github.com/user-attachments/assets/036581a7-2498-427e-bbe8-3be0e5a0e46d)

<br>

![image](https://github.com/user-attachments/assets/b4294cb8-eeff-4e21-a8a9-02ebe04f76e6)


<br>

930

![image](https://github.com/user-attachments/assets/4d6daf55-108a-4488-83d7-0f80b9765e58)

<br>

58

![image](https://github.com/user-attachments/assets/df73a454-ace2-419c-9300-cb65c1ced125)

2.3. Shift

<br>

3.1.MITRE ATT&CK sub-technique for rule: Account Created and Deleted in Short Timeframe
T1078.004

![image](https://github.com/user-attachments/assets/6b746447-5a9d-4921-a9ac-ac9f3871f250)

3.2. Rule frequency (in hrs) for rule: Attempts to sign in to disabled accounts
1h

![image](https://github.com/user-attachments/assets/0eae357b-bcd1-4e3a-bd42-2484dfe88263)

<br>


3.3.ResultType filter in rule: Explicit MFA Deny<br>
500121

![image](https://github.com/user-attachments/assets/6374fce5-d8c4-40a2-9381-3c71761f20e1)

<br>
3.4. AppDisplayName filter in rule: Brute force attack against Azure Portal<br>

Azure Portal

![image](https://github.com/user-attachments/assets/ffdba478-a8d5-44d7-84b5-89a8514d75c8)

<br>

3.5. Category filter in rule: Privileged Role Assigned Outside PIM<br>
RoleManagement

![image](https://github.com/user-attachments/assets/08cd53e8-f2f8-4e72-9a1c-336396fc9b5c)




4.1. Initial Access
![image](https://github.com/user-attachments/assets/cecd0427-d24d-4875-9557-5500ed08bcf6)


<br>


<h1>Incident #1: Account Created and Deleted in Short Timeframe</h1>

4.1.How many accounts were created and deleted in a short time frame?
5
![image](https://github.com/user-attachments/assets/1e142c86-abae-444d-a79c-67bd93a9aed7)


4.2.Which entity deleted these accounts? thmMultiTenantApp

![image](https://github.com/user-attachments/assets/74f3fb32-2b89-4e65-a222-de89a1385176)

4.4. Workflow Id involved in this incident?
b3f33fbcc5a541dc803a9b9bb7a5105f

![image](https://github.com/user-attachments/assets/4caaadbe-2327-4348-874a-205ebf9415d5)


4.5. UPNSuffix 
tryhackmelabs.onmicrosoft.com

![image](https://github.com/user-attachments/assets/d71a27e0-138d-434b-8f48-14c91c3a6753)


5.1. What's the IP Address involved in this incident?
181.214.151.205

![image](https://github.com/user-attachments/assets/131363a6-9413-45cf-8b6c-fde710b2b7a9)

<br>

5.2. IP Geolocation (City)
![image](https://github.com/user-attachments/assets/12db6a8f-3ca6-43b0-96df-4b8e5f42161d)

Miami

6.1.

Tactic for this incident? Credential Access

![image](https://github.com/user-attachments/assets/7d8d5a3a-b605-4297-8eb6-7c8f6fb92919)

<br>

How about its technique? Brute Force

![image](https://github.com/user-attachments/assets/fcc2f5eb-2fcb-487f-b299-c5c045d17cda)

<br>




How many entities 2
![image](https://github.com/user-attachments/assets/7b659c19-e3a8-453e-b3ed-2d933693726d)

Which UPN escalated Marcus' privileges? breakglass@tryhackmelabs.onmicrosoft.com
![image](https://github.com/user-attachments/assets/e38e425f-4284-433a-b1f7-a0e1b39379c7)

Which privileged role has been assigned to Marcus?

Which other user has been a target?

usr-24052103@tryhackmelabs.onmicrosoft.com

185.243.57.70
<br>

![image](https://github.com/user-attachments/assets/95aaaed5-b2cf-46a7-b665-4b9c3f311588)



> 2.2. <em>What's the row count for AuditLogs_CL table? </em><br><a id='2.2'></a>
>> <strong><code>___</code></strong><br>
<p></p>

<br>
<br>

<h2>Task 3 . What is KQL</h2>

<br>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

<br>

> 3.1. <em>What initial service was KQL created for?</em><br><a id='3.1'></a>
>> <strong><code> Azure Data Explorer</code></strong><br>
<p></p>

<br>

> 3.2. <em>Analyze the example query from the task. How many computers will the query return?</em><br><a id='3.2'></a>
>> <strong><code>10</code></strong><br>
<p></p>

<br>

> 3.3. <em>What table is the example query retrieving its data from?</em><br><a id='3.3'></a>
>> <strong><code>Heartbeat</code></strong><br>
<p></p>


<br>

![image](https://github.com/user-attachments/assets/47fd400b-c940-410e-82db-a8f34b62322b)

<br>

![image](https://github.com/user-attachments/assets/602a4857-a1bb-4ac3-8c3d-24a1fc6ff168)

<br>


![image](https://github.com/user-attachments/assets/9f584bfa-4d3e-4670-bf15-799f7f1e36e3)


<br>

![image](https://github.com/user-attachments/assets/8ba95c66-c344-48e5-b65a-933b715d8202)





<br>
<br>

<h2>Task 4 . KQL Concepts in Microsoft Sentinel</h2>

<br>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

<br>

> 4.1. <em>What operator can be used to output results in graphical form?</em><br><a id='4.1'></a>
>> <strong><code>render</code></strong><br>
<p></p>

<br>

> 4.2. <em>What operator can be used to filter a specified table based on specified conditions?</em><br><a id='4.2'></a>
>> <strong><code>where</code></strong><br>
<p></p>

<br>

> 4.3. <em>What user account name was queried in our second example query above?</em><br><a id='4.3'></a>
>> <strong><code>JBOX00$</code></strong><br>
<p></p>

<br>

![image](https://github.com/user-attachments/assets/1394506e-2bfa-45db-87b1-a4674a1d48f9)

<br>

![image](https://github.com/user-attachments/assets/95da9b56-66fa-4f19-9fcb-a74d466faddb)

<br>

![image](https://github.com/user-attachments/assets/434b7f30-2c1d-4dc6-8d15-8484b56b42a3)

<br>

![image](https://github.com/user-attachments/assets/422c5ad5-b0e9-4500-9c34-7d2f1b3fe7c1)




<br>
<br>

<h2>Task 5 . KQL Statement Structure</h2>

<br>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

<br>

> 5.1. <em>What is the name of the table queried in our example query?</em><br><a id='5.1'></a>
>> <strong><code>SecurityEvent</code></strong><br>
<p></p>

<br>

> 5.2. <em>Analyze the example query from the task. What does the query aggregate per computer?</em><br><a id='5.2'></a>
>> <strong><code>EventCount</code></strong><br>
<p></p>

<br>

![image](https://github.com/user-attachments/assets/c3ed4889-105d-468f-b0bd-3514fb9a0137)

<br>

![image](https://github.com/user-attachments/assets/052aa91c-03da-4629-9dbd-b7fbb40ae4db)



<br>
<br>

<h2>Task 6 . KQL Use Cases</h2>

<p>Congratulations! You did it. I am confident that you now understand the concept and structure of KQL queries. Let's explore real-world scenarios to see how KQL can support you, the security analyst, in gaining deeper insights into your security logs.</p>

<br>

<h3>Real-Life Example</h3>
<p>Scenario: Today at the office, you need to identify failed login attempts for a specific user account to investigate potential unauthorized access.<br><br>

Solution: To identify failed login attempts, you can search the SecurityEvent table for failed login attempts using the query below. This will find all failed login attempts across your organization. You can modify the time range to expand your search.</p>

<br>


<br>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

<br>

> 6.1. <em>What is the name of the table queried in our example query?</em>Hint : <em>Run the example query and expand the details to see the Activity entry.</em><br><a id='6.1'></a>
>> <strong><code>An account failed to log on</code></strong><br>
<p></p>

![image](https://github.com/user-attachments/assets/b142d512-8fa7-4498-86b0-fb2e0db8457a)

<br>

![image](https://github.com/user-attachments/assets/26a6efad-a9a1-409d-a0ce-2bfcd8098b4e)


<br>

> 6.2. <em>Run the second example query from the task. What is the account type found?</em><br><a id='6.2'></a>
>> <strong><code>User</code></strong><br>
<p></p>

<br>


![image](https://github.com/user-attachments/assets/eff9e255-2dbb-45e4-a900-3fea581620a2)

<br>

![image](https://github.com/user-attachments/assets/faceda52-d89c-4765-90ba-872ae9fed4ae)




<br>
<br>

<h2>Task 7 . Conclusion</h2>

<h3>Summary</h3>
<p>Let's summarise what we have learned so far:<br><br>

We discussed MS Sentinel as a robust SIEM solution that enables organizations to easily identify, investigate, and respond to security threats. KQL, on the other hand, is an effective method of querying and analyzing security logs. When combined, they form a holistic security operations tool for securing modern digital infrastructure.<br><br>

As we continue to explore KQL, you'll discover its extensive capabilities for enhancing your organization's overall security posture.</p>

<br>

![image](https://github.com/user-attachments/assets/a7e82d34-811a-4c79-b431-a40c2d16ed0a)


<br><br>

<h3>Learning Curve</h3>
<p>To become a skilled security analyst and threat hunter, here are some pointers to get you going:<br>

- Start simple: Begin with basic queries to identify core security events, and gradually progress to more complex ones as you gain confidence.<br>
- Practice makes perfect: The more you practice writing KQL queries, the more comfortable and proficient you'll become.<br>
- Unlock potential: As your KQL proficiency grows, you can delve into advanced concepts like joins, parse, and user-defined functions. These offer even greater capabilities for complex data analysis and threat-hunting scenarios.</p>

<br>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>

<br>

> 7.1. <em>I am ready to learn more about KQL in the KQL (Kusto): Basic Queries room.</em><br><a id='7.1'></a>
>> <strong><code>No answer needed</code></strong><br>
<p></p>

<br>
<br>


![image](https://github.com/user-attachments/assets/41bfdcb5-84a6-4917-b83a-927a366e5027)

![image](https://github.com/user-attachments/assets/2d89f2e2-d14f-48b6-8df1-ce665bb77227)



<br>
<br>

<h1 align="center"> $$\textcolor{#3bd62d}{\textnormal{Room Completed}}$$</h1>
<br>
<p align="center">
<img width="900px" src="https://github.com/user-attachments/assets/84d2351e-244e-4d99-a488-23e91e69d25e"><br>
<img width="900px" src="https://github.com/user-attachments/assets/a77f4f87-a61d-4d85-bb9b-8b5084b23104"></p>


<br>

<h1 align="center"> $$\textcolor{#3bd62d}{\textnormal{My TryHackMe Journey}}$$ </h1>
<br>


<div align="center">

| Date              | Streak   | All Time     | All Time     | Monthly     | Monthly    | Points   | Rooms     | Badges    |
| :---------------: | :------: | :----------: | :----------: | :---------: | :--------: | :------  | :-------: | :-------: |
|                   |          |    Global    |    Brazil    |    Global   |   Brazil   |          | Completed |           |
|   April 15, 2025  |   344    |     286áµ—Ê°    |      7áµ—Ê°     |     241Ë¢áµ—   |     3Ê³áµˆ    |  93,845  |    666    |   59      |

</div>

<br>


<p align="center"> Global All Time: 286áµ—Ê°<br><br><img width="900px" src="https://github.com/user-attachments/assets/08d35cc9-0a61-4e09-bc2f-db36af44d7c2"> </p>

<p align="center"> Brazil All Time: 7áµ—Ê°<br><br><img width="900px" src="https://github.com/user-attachments/assets/33ca0edc-5342-46f0-a2a0-a16f2d95c3c40"> </p>

<p align="center"> Global monthly: 241Ë¢áµ—<br><br><img width="900px" src="https://github.com/user-attachments/assets/fff190a0-2031-4c51-9763-40033b36cb71"> </p>

<p align="center"> Brazil monthly: 3Ê³áµˆ<br><br><img width="900px" src="https://github.com/user-attachments/assets/16fdc401-5f06-48f4-8957-23dc06bc0644"> </p>


<br>


<p align="center">Weekly League: 9áµ—Ê° Silver<br><br><img width="300px" src="https://github.com/user-attachments/assets/5f84cf43-d0aa-4888-bdde-9acb4b0cf627"> </p>

<br>

<h1 align="center">$$\textcolor{#3bd62d}{\textnormal{Thanks for coming!!!}}$$</h1>

<p align="center">Follow me on <a href="https://medium.com/@RosanaFS">Medium</a>, here on <a href="https://github.com/RosanaFSS/TryHackMe">GitHub</a>, and on <a href="https://www.linkedin.com/in/rosanafssantos/">LinkedIN</a>.</p> 

<br>

<h1 align="center">$$\textcolor{#3bd62d}{\textnormal{Thank you}}$$</h1>
<p align="center"><a href="https://tryhackme.com/p/tryhackme">tryhackme</a>, <a href="https://tryhackme.com/p/zieglers">zieglers</a> and <a href="https://tryhackme.com/p/huamanejard">huamanejard</a> for investing your time and effort to develop this challenge so that I could sharpen my skills!</p>
